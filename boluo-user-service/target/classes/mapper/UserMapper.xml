<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.tedu.user.mapper.UserMapper">
    <select id="selectUserCountByUserName" parameterType="String"
            resultType="Integer">
        select count(user_id)
        from user
        where user_name=#{userName};
    </select>

    <insert id="insertUser" parameterType="User">
        insert into user (
            user_name,
            user_password,
            user_phone,
            user_email
        )values(
            #{userName},
            #{userPassword},
            #{userPhone},
            #{userEmail}
        );
    </insert>

    <select id="selectUserByUserNameAndPassword"
            parameterType="User" resultType="User">
        select *
        from user
        where user_name=#{userName} and user_password=#{userPassword};
    </select>

    <select id="selectUserCount" resultType="Integer">
        select count(user_id) from user;
    </select>

    <select id="selectUserByPage" resultType="User">
        select *
        from user
        limit #{start},#{rows}
    </select>

    <select id="selectUserById" resultType="User">
        select *
        from user
        where user_id = #{userId};
    </select>

    <delete id="deleteUserById" parameterType="Integer">
        delete from user
        where user_id = #{userId};
    </delete>

    <!--查看temp表中是否有animalId-->
    <select id="selectStatusByAnimalId" resultType="Temp">
        select *
        from temp
        where animal_id = #{animalId};
    </select>

    <!--查看temp表中是否有userId-->
    <select id="selectStatusByUserId" resultType="Temp">
        select *
        from temp
        where user_id = #{userId};
    </select>

    <!--查看是否重复申请-->
    <select id="selectStatusByUserIdAndAnimalId" parameterType="Integer" resultType="Temp">
        select *
        from temp
        where user_id = #{userId} and animal_id = #{animalId};
    </select>

    <!-- 申请领养动物、往伪领养表中添加数据 -->
    <insert id="insertTemp">
        insert into temp(
            user_id,
            animal_id,
            user_name
        )values(
            #{userId},
            #{animalId},
            #{userName}
        )
    </insert>

    <!--查看自己正在申请领养的动物-->
    <select id="selectTemp" parameterType="Integer" resultType="Animal">
        SELECT animal_id,animal_name,give_name,give_phone
            FROM animal
            WHERE animal_id = (SELECT animal_id
                                FROM temp
                                WHERE user_id = #{userId}
                                );
    </select>

    <select id = "selectAdoptCount" resultType="Integer">
        select count(user_id) from adopt;
    </select>

    <!-- 查看自己被批准的可以领养的动物 -->
    <select id="selectAdoptByUserId" parameterType="Integer" resultType="Animal">
        SELECT *
        FROM animal
        WHERE animal_id = (SELECT animal_id
                            FROM adopt
                            WHERE user_id = #{userId}
		                    );
    </select>

    <!-- 申请成为志愿者 -->
    <update id="updateUserById">
        update user set
        user_type = 2
        where user_id = #{userId};
    </update>

    <!--申请成为志愿者-往volunteer表中插入数据-->
    <insert id="insertVolunteer" parameterType="Volunteer">
        insert into volunteer(
            user_id,
            volunteer_name,
            volunteer_gender,
            volunteer_age,
            volunteer_address,
            volunteer_phone,
            volunteer_image
        )values (
            #{userId},
            #{volunteerName},
            #{volunteerGender},
            #{volunteerAge},
            #{volunteerAddress},
            #{volunteerPhone},
            #{volunteerImage}
        );
    </insert>

    <!--查看自己的志愿者状态-->
    <select id="checkVolunteer" parameterType="Integer" resultType="Volunteer">
        select *
        from volunteer
        where user_id = #{userId};
    </select>

    <!--申请防疫物资-->
    <insert id="shenqing" parameterType="Shenqing">
        insert into shenqing(
            user_id,
            user_name,
            user_phone,
            user_info,
            shenqing_address,
            shenqing_type
        )values(
            #{userId},
            #{userName},
            #{userPhone},
            #{userInfo},
            #{shenqingAddress},
            #{shenqingType}
        )
    </insert>

    <!--查看自己物资正在申请的状态-->
    <select id="chashenqing" parameterType="Integer" resultType="String">
        select user_status
        from user
        where user_id = #{userId};
    </select>

    <!--修改个人信息-->
    <update id="xiugai" parameterType="User">
        update user set
        user_name = #{userName},
        user_password = #{userPassword},
        user_phone = #{userPhone},
        user_email = #{userEmail}
        where user_id = #{userId};
    </update>

    <!--查询文章数量-->
    <select id = "selectWenzhangCount" resultType="Integer">
        select count(wenzhang_id) from wenzhang;
    </select>

    <!--文章分页查看-->
    <select id="selectWenzhangByPage" resultType="Wenzhang">
        select *
        from wenzhang
        limit #{start},#{rows};
    </select>

    <!--查看单个文章-->
    <select id="selectWenzhangById" resultType="Wenzhang">
        select *
        from wenzhang
        where wenzhang_id = #{wenzhangId};
    </select>

    <!--留言-->
    <insert id="liuyan" parameterType="Message">
        insert into message(
            wenzhang_id,
            user_name,
            leave_message
        )values(
            #{wenzhangId},
            #{userName},
            #{leaveMessage}
        )
    </insert>

    <!--查询评论数-->
    <select id = "selectmessageCount" resultType="Integer">
        select count(message_id) from message;
    </select>

    <!--批量查看评论-->
    <select id="selectMessageByPage" parameterType="Message" resultType="Message">
        select *
        from message
        where wenzhang_id = #{wenzhangId}
        limit #{start},#{rows};
    </select>

    <!--查询所有评论数-->
    <select id = "selectallmessage" resultType="Integer">
        select count(message_id) from message;
    </select>

    <!--查看所有评论-->
    <select id="selectallMessage" resultType="Message">
        select *
        from message
        limit #{start},#{rows};
    </select>

    <!--查询所有患者数量-->
    <select id = "selectAllHuanzhe" resultType="Integer">
        select count(huanzhe_id) from huanzhe;
    </select>

    <!--查看所有患者数据-->
    <select id="selectHuanzheByPage" resultType="Huanzhe">
        select *
        from huanzhe
        limit #{start},#{rows};
    </select>

    <!--全文检索出来的数量-->
    <select id="jiansuoCount" parameterType="String" resultType="Wenzhang">
        select count(wenzhang_id)
        from wenzhang

    </select>

    <!--全文检索-->
    <select id="jiansuo" resultType="Wenzhang">
        SELECT *
        FROM wenzhang
        WHERE wenzhang_title LIKE concat('%',#{text},'%')
        limit #{start},#{rows};
    </select>


    <!--宿舍报修申请表-->
    <insert id="shenqingFix" parameterType="Fix">
        insert into fix(
            fixId,
            user_name,
            gender,
            grade,
            num,
            phone,
            date,
            object,
            info,
            image,
            status
        )values(
            #{fixId},
            #{userName},
            #{gender},
            #{grade},
            #{num},
            #{phone},
            #{date},
            #{object},
            #{info},
            #{Image},
            #{status}
        );
    </insert>

</mapper>



















